# Cargo configuration for optimal AES/crypto performance
# See: https://github.com/sseemayer/keepass-rs/blob/master/.cargo/config.toml
#
# NOTE: `target-cpu=native` optimizes for the local CPU, which is ideal for
# development but may produce binaries incompatible with older CPUs.
# For release builds targeting distribution, CI should either:
# - Override with RUSTFLAGS="-C target-cpu=generic"
# - Or use Tauri's cross-compilation which handles this appropriately

# Enable native CPU optimizations for better AES key derivation performance.
# This enables AES-NI on x86/x64 CPUs that support it.
[build]
rustflags = ["-C", "target-cpu=native"]

# ARM64 Linux: Enable hardware AES acceleration (requires Rust 1.61+)
[target.aarch64-unknown-linux-gnu]
rustflags = ["-C", "target-cpu=native", "--cfg", "aes_armv8"]

# ARM64 macOS (Apple Silicon): Enable hardware AES acceleration
[target.aarch64-apple-darwin]
rustflags = ["-C", "target-cpu=native", "--cfg", "aes_armv8"]

# ARM64 Android: Enable hardware AES acceleration
[target.aarch64-linux-android]
rustflags = ["--cfg", "aes_armv8"]

# WebAssembly: Configure random number generation backend
[target.wasm32-unknown-unknown]
rustflags = ["--cfg", "getrandom_backend=\"wasm_js\""]
